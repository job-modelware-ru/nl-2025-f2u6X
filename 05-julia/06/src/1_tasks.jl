# @task - создает новую задачу (не запускает автоматически)
# Задача — это легковесный поток, который выполняется конкурентно
task = @task begin
    for i in 1:3
        println("Итерация задачи: ", i)
        sleep(0.1) # Имитация работы — блокирующая операция
    end
    return "Задача завершена" # Возвращает результат
end

# schedule - планирует выполнение задачи в пуле задач
# Не блокирует текущий поток, задача выполняется в фоне
schedule(task)
# fetch - ожидает завершение задачи (блокирующая операция), поток ждет и возвращает результат
result = fetch(task)
println("Результат задачи: ", result)

# @async - создаёт и немедленно запускает задачу (аналог @task + schedule)
@async begin
    println("Задача запущена, выполняется длительная операция в фоне")
    sleep(1) # Долгая операция
    println("Фоновая задача завершена")
end

# @sync - ожидает завершения всех внутренних асинхронных операций
# Гарантирует, что все созданные внутри задачи завершатся
@sync begin
    for i in 1:3
        @async begin
            # sleep(rand()) — каждая задача имеет разное время выполнения
            sleep(rand()) # Случайная задержка от 0 до 1 секунды
            println("Асинхронная задача $i завершена")
        end
    end
end
# Эта строка выполнится только после ВСЕХ асинхронных задач
println("Все задачи завершены — контроль возвращен")